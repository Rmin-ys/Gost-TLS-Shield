#!/bin/bash

# ==========================================
# ğŸ’ GOST PRO UI EDITION v6.5
# Clean, Sharp & High-Speed
# ==========================================

# Colors
B_Cyan='\033[1;36m'
B_Green='\033[1;32m'
B_Red='\033[1;31m'
B_Yellow='\033[1;33m'
B_Purple='\033[1;35m'
NC='\033[0m' # No Color

# Symbols
CHECK="âœ”"
ARROW="âœ"

header() {
    clear
    echo -e "${B_Cyan}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
    echo -e "${B_Cyan}â”‚${NC}          ${B_Purple}${BOLD}GOST SHIELD PRO MANAGER v6.5${NC}          ${B_Cyan}â”‚${NC}"
    echo -e "${B_Cyan}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"
}

draw_info() {
    echo -e "${B_Cyan}  $ARROW $1${NC}"
}

setup_iran() {
    header
    echo -e "  ${B_Yellow}[ ENTRY SETUP - IRAN SERVER ]${NC}\n"
    read -p "  IP/Domain Overseas : " r_ip
    read -p "  Bridge Port       : " b_port
    read -p "  Password          : " s_pass
    read -p "  Local Ports       : " raw_ports
    
    ports=$(echo $raw_ports | sed 's/Ùˆ/,/g' | tr -d ' ')
    IFS=',' read -ra ADDR <<< "$ports"
    ARGS=""
    for i in "${ADDR[@]}"; do
        ARGS+="-L tcp://:$i/127.0.0.1:$i "
    done

    EXEC_CMD="/usr/local/bin/gost $ARGS -F ss://chacha20:$s_pass@$r_ip:$b_port?mtu=1350&tfo=true"
    create_service "$EXEC_CMD"
}

setup_overseas() {
    header
    echo -e "  ${B_Yellow}[ EXIT SETUP - OVERSEAS SERVER ]${NC}\n"
    read -p "  Bridge Port      : " b_port
    read -p "  Password         : " s_pass
    read -p "  Destination Port : " d_port
    
    EXEC_CMD="/usr/local/bin/gost -L ss://chacha20:$s_pass@:$b_port/127.0.0.1:$d_port?tfo=true"
    create_service "$EXEC_CMD"
}

show_status() {
    header
    if systemctl is-active --quiet gost-tunnel; then
        echo -e "  Status: ${B_Green}$CHECK Active${NC}"
        echo -e "  Ports : ${B_Cyan}$(netstat -tlpn | grep gost | awk '{print $4}' | cut -d: -f2 | xargs)${NC}"
    else
        echo -e "  Status: ${B_Red}âœ˜ Inactive${NC}"
    fi
    echo -e "\n  ${B_Yellow}Last Logs:${NC}"
    journalctl -u gost-tunnel -n 5 --no-pager | awk '{print "  â€º " $NF}'
    echo -e "\n${B_Cyan}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    read -p "  Press Enter..."
}

create_service() {
    local cmd=$1
    echo -e "\n  ${B_Yellow}Deploying...${NC}"
    killall -9 gost 2>/dev/null
    cat <<EOF > /etc/systemd/system/gost-tunnel.service
[Unit]
Description=Gost Pro Tunnel
After=network.target

[Service]
Type=simple
ExecStart=$cmd
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF
    systemctl daemon-reload
    systemctl enable gost-tunnel >/dev/null 2>&1
    systemctl restart gost-tunnel
    echo -e "  ${B_Green}$CHECK Service Started Successfully!${NC}"
    sleep 2
}

# Main Menu
while true; do
    header
    echo -e "  ${B_Cyan}1)${NC} ${B_Green}Setup Iran Server${NC}"
    echo -e "  ${B_Cyan}2)${NC} ${B_Green}Setup Overseas Server${NC}"
    echo -e "  ${B_Cyan}3)${NC} ${B_Yellow}Show Status & Logs${NC}"
    echo -e "  ${B_Cyan}4)${NC} ${B_Red}Uninstall / Stop Tunnel${NC}"
    echo -e "  ${B_Cyan}5)${NC} Exit"
    echo -e "\n${B_Cyan}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    read -p "  Select an option [1-5]: " opt

    case $opt in
        1) setup_iran ;;
        2) setup_overseas ;;
        3) show_status ;;
        4) systemctl stop gost-tunnel; killall -9 gost; echo -e "  ${B_Red}Stopped.${NC}"; sleep 1 ;;
        5) exit 0 ;;
        *) echo -e "  Invalid Choice!"; sleep 1 ;;
    esac
done
